$(function(){$(document).ajaxStart(function(){layer.load(1)});$(document).ajaxStop(function(){layer.closeAll("loading")});document.onkeydown=check});function check(b){var a;if(!b){var b=window.event}if(b.keyCode){a=b.keyCode}else{if(b.which){a=b.which}}if(((event.keyCode==8)&&((event.srcElement.type!="text"&&event.srcElement.type!="textarea"&&event.srcElement.type!="password")||event.srcElement.readOnly==true))||((event.ctrlKey)&&((event.keyCode==78)||(event.keyCode==82)))||(event.keyCode==116)){event.keyCode=0;event.returnValue=false}return true}layer.config({extend:"extend/layer.ext.js"});var winWidth=0;var winHeight=0;function findDimensions(){if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}if(document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth){winHeight=document.documentElement.clientHeight;winWidth=document.documentElement.clientWidth}}function isNull(a){if(a&&a!=""){return false}else{return true}}function isNullOrUndefined(a){if(a==null||a==""||a==undefined){return true}else{return false}}function resultErr(a){if(a.result==1){messageBoxAdv("登录超时","用户未登录或超时，请重新登录！",{title:"登陆超时"});if(window!=top){top.location.href=ctx+"/login"}else{location.href="/"}}else{messageBoxAdv(a.errMsg,{title:"操作出错"})}}function messageBox(a){layer.alert(a,{title:"消息框",btn:["确定"],time:5000})}function messageBoxCallback(b,c,a){if(!a){a=1500}layer.open({content:b,success:function(d,e){setTimeout(function(){c()},a)}})}function messageBoxAdv(c,b){var a={title:"消息框",btn:["确定"],time:5000};if(b&&typeof(b)=="object"){a=$.extend(a,b)}layer.alert(c,a)}function execCallback(b,a){if(Object.prototype.toString.call(a)==="[object Array]"){if(a.length==1){b(a[0])}else{if(a.length==2){b(a[0],a[1])}else{if(a.length==3){b(a[0],a[1],a[2])}else{if(a.length==4){b(a[0],a[1],a[2],a[3])}else{if(a.length==5){b(a[0],a[1],a[2],a[3],a[4])}else{if(a.length==6){b(a[0],a[1],a[2],a[3],a[4],a[5])}}}}}}}else{b()}}function confirmBox(c,d,a){if(!c){c=""}var b="确认框";layer.confirm(c,{title:b,btn:["确定","取消"],yes:function(f,e){execCallback(d,a);layer.close(f)}})}function promptBox(c,d,a,b){if(!b){b=2}layer.prompt({title:c,formType:b,},function(f,e){a.push(f);execCallback(d,a);layer.close(e)})}function dialogBox(b,c,d,a){if(!d){d="500px"}if(!a){a="320px"}layer.open({type:2,title:b,shadeClose:false,shade:false,maxmin:false,area:[d,a],content:c})}function dialogBox4auto(d,b){findDimensions();var c=(winWidth-120)+"px";var a=(winHeight-50)+"px";layer.open({type:2,title:d,shadeClose:false,shade:false,maxmin:true,zIndex:5999999999,area:[c,a],content:b})}function closeDialogBox(){var a=parent.layer.getFrameIndex(window.name);parent.layer.close(a)}function uploadImage(c,b){var a=ctx+"/attach/upload/image?attachField="+c+"&attachImage="+b;dialogBox("图片上传",a,"650px","475px")}function uploadImages(c,b){var a=ctx+"/attach/upload/images?attachField="+c+"&attachImage="+b;dialogBox("图片上传",a,"650px","475px")}function uploadImage4Alipay(d,c,b){var a=ctx+"/attach/upload/image4Alipay?attachField="+d+"&attachImage="+c+"&alipayId="+b;dialogBox("图片上传",a,"650px","475px")}function uploadImageComplete(d,c,b,a){$("#"+d).val(b);$("#"+c).html('<img alt="image" src="'+a+'" width="100%" height="100%"/>')}function uploadImageComplete4Alipay(f,e,d,a,c,b){$("#"+f).val(c);$("#"+d).val(a);$("#"+e).html('<img alt="image" src="'+b+'" width="100%" height="100%"/>')}function uploadFiles(c,a){var b=ctx+"/attach/upload/files?attachField="+c+"&attachDivId="+a;dialogBox("附件上传",b,"650px","475px")}function isImageType(a){if(isNull(a)){return false}var b=a.toLowerCase();if("jpg"==b||"jpeg"==b||"tiff"==b||"raw"==b||"bmp"==b||"gif"==b||"png"==b){return true}return false}function uploadFileComplete(d,c,b,f,e){var a=$("#"+d).val();if(a){a+=","+b}else{a=b}$("#"+d).val(a);dispAnAttachFile(d,c,b,f,e)}function uploadFileComplete4Alipay(e,d,h,c,g,f,b){var a=$("#"+e).val();a=c;$("#"+e).val(a);$("#"+h).val(b);dispAnAttachFile(e,d,c,g,f)}function dispAnAttachFile(g,c,a,e,h){var d=ctx+"/attach/download?attachId="+a;var i=e;if(typeof(readonly)=="undefined"){readonly=false}var b='  <div class="file">    <span class="corner"></span>';if(!isImageType(h)){b+='    <div class="icon"><i class="fa fa-bar-chart-o"></i></div>'}else{b+='    <div class="image"><img alt="image" class="img-responsive" src="'+d+'"></div>'}b+='    <div class="file-name">'+i+'</div>    <div class="file-name text-center">      <a class="btn btn-white btn-bitbucket btn-sm" href="'+d+'" target="_blank">        <i class="fa fa-download"></i>       </a>';if(!readonly){b+='      <a class="btn btn-white btn-bitbucket btn-sm" onclick="_removeAttach(\''+a+"','"+i+"','"+g+'\')">        <i class="fa fa-trash"></i>       </a>      <a class="btn btn-white btn-bitbucket btn-sm" onclick="_renameAttach(\''+a+'\')">        <i class="fa fa-edit"></i>       </a>'}b+="    </div>  </div>";var f=$("#attachDiv_"+a);if(f.length>0){f.html(b)}else{var j=$("#"+c).html();$("#"+c).prepend('<div class="file-box" name="attachDivDisp" id="attachDiv_'+a+'">'+b+"</div>");$("#noneImg").hide()}}function _removeAttach(b,c,a){confirmBox('确定要删除附件"'+c+'"吗？',doRemoveAttach,[b,a])}function doRemoveAttach(b,a){$.ajax({type:"post",url:ctx+"/attach/maintain/remove",data:{attachId:b},dataType:"json",success:function(c){if(c.success){messageBox("操作成功!");$("#attachDiv_"+b).remove();var g=$("#"+a).val();g=g.replace(b,"");var f="";var d=g.split(",");for(var e=0;e<d.length;e++){if(!isNullOrUndefined(d[e].trim())){if(!isNullOrUndefined(f.trim())){f+=","}f+=d[e]}}console.log(1111);console.log(f);$("#"+a).val(f);if(f==""){$("#attachFileDiv").html('<div class="file-box" id="noneImg"><div class="file"> <div class="icon" style="height:155px;">		<i class="fa fa-image" style="padding-top:30px;"></i> </div> </div></div>');$("#noneImg").show();console.log(2222)}}else{resultErr(c)}}})}function _renameAttach(a){var b=ctx+"/attach/maintain/rename?attachId="+a;dialogBox("图片上传",b,"420px","300px")}function imageView(c,e){findDimensions();var a=winWidth-160;var b=winHeight-10;var d=ctx+"/attach/maintain/imageView?attachId="+c+"&winHeight="+b;dialogBox("图片查看器",d,a+"px",b+"px")}function baiduMapMarker(e,d,b){findDimensions();var g="";if($("#"+e).length>0){g=$("#"+e).val()}var a=winWidth-100;var c=winHeight-10;var f=ctx+"/map/baidu/marker?addr="+g+"&lngField="+d+"&latField="+b;dialogBox("设置区域经纬度信息",f,a+"px",c+"px")}function userTreePicker(a,d){findDimensions();var b=winHeight-10;var c=ctx+"/system/account/userTreePicker?fieldId="+a+"&fieldDisp="+d;dialogBox("接收人选择",c,"400px",b+"px")}function industryPicker(a,c){var b=ctx+"/base/industry/industryPicker?fieldId="+a+"&fieldDisp="+c+"&industryIds="+$("#"+a).val();dialogBox("行业类型选择器",b,"560px","400px")}function date2Str(c){if(c==""||c==null){return""}var f=c.getFullYear();var a=c.getMonth()+1;if(a<10){a="0"+a}var e=c.getDate();if(e<10){e="0"+e}var b=f+"-"+a+"-"+e;return b}function registerBootstrapTableResizeEvent(){$(window).resize(function(){$dataTable.bootstrapTable("resetView")})}function resetBootstrapTableHeight(){$dataTable.on("post-body.bs.table",function(){setTimeout("doResetBootstrapTableHeight()",700)})}function calcBootstrapTableHeight(){findDimensions();var a=winHeight-$(".ibox-title").outerHeight(true)-101;if(a<550){return 550}return a}function doResetBootstrapTableHeight(){$dataTable.bootstrapTable("resetView",{height:calcBootstrapTableHeight()})}function registerBootstrapTableResizeWithHeightEvent(){$(window).resize(function(){doResetBootstrapTableHeight()})}function closeCurrentNavTab(){parent.closeNavtab($(window.frameElement).data("id"))}function toDay(){return date2Str(new Date())}function getSelectedIds(){var b=$("[name='ids']");var c=new Array();var d=0;for(var a=0;a<b.length;a++){if(b[a].checked){c[d]=b[a].value;d++}}if(d<=0){messageBox("请至少选中一条记录！");return null}return c}function checkboxAll(a){var c=$("[name='ids']");for(var b=0;b<c.length;b++){c[b].checked=a}}function formatDate(a,b){if(!a){return}if(!b){b="yyyy-MM-dd"}switch(typeof a){case"string":a=new Date(a.replace(/-/,"/"));break;case"number":a=new Date(a);break}if(!a instanceof Date){return}var c={yyyy:a.getFullYear(),M:a.getMonth()+1,d:a.getDate(),H:a.getHours(),m:a.getMinutes(),s:a.getSeconds(),MM:(""+(a.getMonth()+101)).substr(1),dd:(""+(a.getDate()+100)).substr(1),HH:(""+(a.getHours()+100)).substr(1),mm:(""+(a.getMinutes()+100)).substr(1),ss:(""+(a.getSeconds()+100)).substr(1)};return b.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,function(){return c[arguments[0]]})}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}};