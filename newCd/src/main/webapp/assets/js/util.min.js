var winWidth=0;var winHeight=0;function findDimensions(){if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}if(document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth){winHeight=document.documentElement.clientHeight;winWidth=document.documentElement.clientWidth}}function isNullOrUndefined(obj){if(obj==null||obj==""||obj==undefined){return true}else{return false}}function modal(e,obj){console.log(e);e.preventDefault();$remote=obj.remote||obj.href,$modal=$('<div class="modal" id="ajaxModal"><div class="modal-body"></div></div>');$("body").append($modal);$modal.modal({backdrop:"static",keyboard:false});if($remote.indexOf("?")>-1){$remote+="&t="+(new Date()).valueOf()}else{$remote+="?t="+(new Date()).valueOf()}$modal.load($remote)}function modalHref(href,divId){$modal=$('<div class="modal example-modal-lg" id="'+divId+'"><div class="modal-body"></div></div>');$("body").append($modal);$modal.modal({backdrop:"static",keyboard:false});if(href==undefined){href=""}if(href.indexOf("?")>-1){href+="&t="+(new Date()).valueOf()}else{href+="?t="+(new Date()).valueOf()}console.log(href);$modal.load(href)}function showAjaxLoading(){$("body").append('<div class="alertify vertical-align text-center" name="commonDialoag"><div class="vertical-align-middle loader-round-circle-self font-size-100"></div></div>')}function hideAjaxLoading(){$("div[name='commonDialoag']").remove()}function closeModal(divId){$("#"+divId).modal("hide");$("#"+divId).remove()}function cmpPicker(){modalHref(ctx+"/cmp/picker","ajaxModal")}function corpSelect(){modalHref(ctx+"/corp/corpSelector","corpModal")}function accountPicker(type){if(isNullOrUndefined(type)){type==1}modalHref(ctx+"/system/account/accountPicker?type="+type,"ajaxModal")}function uploadWords(e,attachIds,attachDivId){e.preventDefault();$remote=ctx+"/attach/upload/words?attachField="+attachIds+"&attachDivId="+attachDivId,$modal=$('<div class="modal" id="filesModal"><div class="modal-body"></div></div>');$("body").append($modal);$modal.modal({backdrop:"static",keyboard:false});$modal.load($remote)}function uploadOneFileComplete(attachFieldId,attachDivId,attachFileId,attachFileName,attachFileSuffix){$("#contractAttach").val(attachFileId);$("#contractAttach").trigger("input:changed",attachFileId);var downloadUrl=ctx+"/attach/download?attachId="+attachFieldId;var dispFilename=attachFileName;if(typeof(readonly)=="undefined"){readonly=false}if(attachFileSuffix=="mp4"&&typeof videoUploadSuccess==="function"){videoUploadSuccess(attachId,attachField,downloadUrl,attachDivId);return}var disphtml=""+'  <div style="padding:15px;float:left;">'+"    <div>";if(!isImageType(attachFileSuffix)){disphtml+=""+"    <img src="+ctx+'"/assets/images/upload.png"  style="height:150px;" />'}else{disphtml+=""+'    <img src="'+downloadUrl+'" data-high-res-src="'+downloadUrl+'" class="gallery-items"  style="height:150px"  />'}disphtml+=""+"    </div>"+'    <div style="margin-top:5px;">'+dispFilename+"</div>"+'    <div class="text-left" style="height:25px">'+'      <a class="btn btn-white btn-bitbucket btn-xs" href="'+downloadUrl+'" target="_blank">'+'        <i class="fa fa-download"></i> 下载'+"      </a>";if(!readonly){disphtml+=""+'      <a class="btn btn-white btn-bitbucket btn-xs" onclick="_removeAttach(\''+attachFileId+"','"+dispFilename+"','"+attachFieldId+"')\">"+'        <i class="fa fa-trash"></i> 删除'+"      </a>"}disphtml+=""+"    </div>"+"  </div>";$("#"+attachDivId).html('<div class="file-box" name="'+attachFieldId+'" id="attachDiv_'+attachFileId+'">'+disphtml+"</div>");if($("#attachError")){$("#attachError").remove();if($("#btnSubmit")){$("#attachError").removeAttr("disabled")}}}function uploadFile(attachField,attachDivId,attachNum,fileType,position){if(isNullOrUndefined(attachNum)){attachNum=1}if(isNullOrUndefined(fileType)){fileType="a"}if(isNullOrUndefined(position)){position="m"}$remote=ctx+"/attach/upload?attachField="+attachField+"&attachDivId="+attachDivId+"&attachNum="+attachNum+"&fileType="+fileType+"&position="+position,$modal=$('<div class="modal" id="filesModal"><div class="modal-body"></div></div>');$("body").append($modal);$modal.modal({backdrop:"static",keyboard:false});$modal.load($remote)}function uploadFileComplete(attachField,attachDivId,attachId,attachFileName,attachFileSuffix,attachNum,fileType,position){var downloadUrl=ctx+"/attach/download?attachId="+attachId;var downloadThumbUrl=ctx+"/attach/download/thumb?attachId="+attachId;var _attachFieldVal=$("#"+attachField).val();if(_attachFieldVal){_attachFieldVal+=","+attachId}else{_attachFieldVal=attachId}if(attachNum==1){_attachFieldVal=attachId}$("#"+attachField).val(_attachFieldVal);$("#"+attachField).trigger("input:changed",_attachFieldVal);if(attachFileSuffix=="mp4"&&typeof videoUploadSuccess==="function"){videoUploadSuccess(attachId,attachField,downloadUrl,attachDivId);return}var disphtml=""+'  <div style="padding: 0 0 0.5rem 1.0715rem;width:150px;height:150px;" id="attachDiv_'+attachId+'">'+'    <figure class="overlay overlay-hover" style="height:135px;width:135px;">';if(!isImageType(attachFileSuffix)){disphtml+='<div class="img_wd"></div>'}else{disphtml+=' <img class="overlay-figure gallery-items" src="'+downloadThumbUrl+'"data-high-res-src="'+downloadUrl+'" alt="'+attachFileName+'" >'}disphtml+=""+'    <figcaption class="overlay-panel overlay-background overlay-fade overlay-icon">';if(isOnLine(attachFileSuffix)){disphtml+='	<a class="icon wb-search" style="margin:0 5px;font-size:1.286rem;width:1.286rem;"  href="https://view.officeapps.live.com/op/view.aspx?src='+downloadUrl+'" target="_blank" ></a>'}else{if(attachFileSuffix=="pdf"){disphtml+='<a class="icon wb-search" style="margin:0 5px;font-size:1.286rem;width:1.286rem;"  href="'+downloadUrl+'" target="_blank" ></a>'}else{if(isImageType(attachFileSuffix)){disphtml+='<a class="icon wb-search" style="margin:0 5px;font-size:1.286rem;width:1.286rem;"  href="javascript:void(0)" onclick="clickImg(event,this)" ></a>'}else{if(isVideoType(attachFileSuffix)){disphtml+='<a class="icon wb-search" style="margin:0 5px;font-size:1.286rem;width:1.286rem;"  href="javascript:void(0)" onclick="videoPlay(\''+attachId+"',2)\" ></a>"}}}}disphtml+='  <a class="icon wb-download" style="margin:0 5px;font-size:1.286rem;width:1.286rem" href="'+downloadUrl+'" target="_self" ></a>'+'    	<a class="icon wb-close" style="margin:0 5px;font-size:1.286rem;width:1.286rem"  onclick="_removeAttach(\''+attachId+"','"+attachField+"','"+attachDivId+"','"+attachNum+"','"+fileType+"','"+position+"')\"></a>";if(position=="m"){disphtml+='    	<h5 class="animation-slide-bottom" style="margin:-15px;text-align:center;word-wrap:break-word;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp:2;overflow: hidden;">'+attachFileName+"</h5>"}disphtml+="    </figcaption>"+"  </figure>";if(position=="b"){disphtml+='<h5 class="animation-slide-bottom" style="margin:10px;text-align:center;word-wrap:break-word;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp:2;overflow: hidden;">'+attachFileName+"</h5>"}disphtml+="</div>";if(attachNum==1){$("#"+attachDivId).html(disphtml)}else{$("#"+attachDivId).append(disphtml)}if(typeof uploadSuccess==="function"){uploadSuccess(attachId,attachField,attachDivId)}else{}}function isImageType(fileType){if(isNullOrUndefined(fileType)){return false}var lowerType=fileType.toLowerCase();if("jpg"==lowerType||"jpeg"==lowerType||"tiff"==lowerType||"raw"==lowerType||"bmp"==lowerType||"gif"==lowerType||"png"==lowerType){return true}return false}function isOnLine(fileType){if(isNullOrUndefined(fileType)){return false}var lowerType=fileType.toLowerCase();if("doc"==lowerType||"docx"==lowerType||"xls"==lowerType||"xlsx"==lowerType||"ppt"==lowerType||"pptx"==lowerType){return true}return false}function isVideoType(fileType){if(isNullOrUndefined(fileType)){return false}var lowerType=fileType.toLowerCase();if("mp4"==lowerType||"webm"==lowerType||"ogg"==lowerType){return true}return false}function _removeAttach(attachId,attachField,attachDivId,attachNum,fileType,position){if(isNullOrUndefined(attachNum)){attachNum=1}if(isNullOrUndefined(fileType)){fileType="a"}if(isNullOrUndefined(position)){position="m"}if(attachNum==1){$("#"+attachField).val("");var disphtml=""+'  <div style="padding:0 0 0 1.0715rem;width:150px;height:150px;" >'+'	<figure class="overlay" style="height:135px;width:135px;">'+"	<img src="+ctx+'"/assets/images/upload.png"  class="overlay-figure" />'+'	<figcaption class="overlay-panel overlay-background overlay-fade overlay-icon">'+'		<a class="icon wb-upload" style="margin:0 5px;font-size:1.286rem;width:1.286rem" onclick="uploadFile(\''+attachField+"','"+attachDivId+"',1,'"+fileType+"','"+position+"')\"></a> "+"	</figcaption>"+"  </figure>"+"</div>";$("#"+attachDivId).html(disphtml);if(typeof removeAttachSuccess==="function"){removeAttachSuccess(attachId,attachField,attachDivId)}else{console.log("不存在该函数")}}else{var attachs=$("#"+attachField).val();attachs=attachs.replace(attachId,"");var newattaches="";var attach=attachs.split(",");for(var i=0;i<attach.length;i++){if(!isNullOrUndefined(attach[i])){if(!isNullOrUndefined(newattaches)){newattaches+=","}newattaches+=attach[i]}}$("#"+attachField).val(newattaches);$("#attachDiv_"+attachId).remove();if(typeof removeAttachSuccess==="function"){removeAttachSuccess(attachId,attachField,attachDivId)}else{console.log("不存在该函数")}}}function clickImg(e,obj){imgShow();$(obj).parent().siblings().click()}function videoPlay(attachId,type){modalHref(ctx+"/attach/maintain/videoPlay?attachId="+attachId+"&type="+type,"videoPlayModal")}function jqVideoPlay(attachId,url){modalHref(ctx+"/attach/maintain/jqVideoPlay?url="+url+"&attachId="+attachId,"jqVideoModal")}function registerAlertify4Local(){alertify.okBtn("确定").cancelBtn("关闭").theme("bootstrap").logPosition("top right").delay(1000)}function str2Date(str){if(isNullOrUndefined(str)||str.length<8){return null}var year=str.substring(0,4);var month=str.substring(4,6);var day=str.substring(6,8);var HH=0,mm=0;if(str.length>8){HH=str.substring(9,11);mm=str.substring(12,14)}var d=new Date();d.setFullYear(year,month-1,day);d.setHours(HH);d.setMinutes(mm);d.setSeconds(0);return d}function month2Str(date){if(isNullOrUndefined(date)){return""}var y=date.getFullYear();var m=date.getMonth()+1;if(m<10){m="0"+m}var redate=y+""+m;return redate}function plusMonth(yearMonth,n){var t=str2Date(yearMonth+"01");t.setMonth(t.getMonth()+n);return month2Str(t)}function imgShow(){var galleryImgs=[];var viewer=ImageViewer();var curImageIdx=1;$(".gallery-items").each(function(i){var small=$(this).attr("src");var big=$(this).attr("data-high-res-src");var galleryImg=new Object();galleryImg.small=small;galleryImg.big=big;galleryImgs.push(galleryImg)});var total=galleryImgs.length;var wrapper=$(".iv-image-wrap");wrapper.find(".total").html(total);if(!$("#iv-image-wrap_next").hasClass("next")){$(".iv-image-wrap").append('<img id="iv-image-wrap_next" class="next" style="cursor:pointer;">');$(".iv-image-wrap").append('<img class="prev" style="cursor:pointer;">')}wrapper.find(".next").click(function(){curImageIdx++;if((curImageIdx+1)>total){curImageIdx=0}imgObj=galleryImgs[curImageIdx];viewer.load(imgObj.small,imgObj.big)});wrapper.find(".prev").click(function(){curImageIdx--;if(curImageIdx<0){curImageIdx=(total-1)}imgObj=galleryImgs[curImageIdx];viewer.load(imgObj.small,imgObj.big)});$(".gallery-items").each(function(i){$(this).click(function(){imgObj=galleryImgs[i];curImageIdx=i;viewer.show(imgObj.small,imgObj.big)})})}function clickImg(e,obj){imgShow();$(obj).parent().siblings().click()}function downloadQcloudFile(id){self.location=ctx+"/attach/download/downloadQcloudFile?id="+id}function resultErr(result){console.log(result);if(result.result==1){toastr.error("用户未登录或超时，请重新登录！","用户未登录或超时",{positionClass:"toast-top-center"});if(window!=top){top.location.href=ctx+"/login"}else{location.href="/"}}else{toastr.error(result.msg,"",{positionClass:"toast-top-center"})}}function registerWebuiPopoverEvent(obj){$(obj).webuiPopover()}function adjustPageSideHeight(time){setTimeout(function(){var panelBodyHeight=$(".panel-body").outerHeight(true);if(winHeight>panelBodyHeight){$(".scrollable-container").css({"height":(winHeight-100)+"px"})}else{$(".scrollable-container").css({"height":(panelBodyHeight)+"px"})}},time)}function uploadLargeFile(attachField,attachDivId,attachNum,fileType,position){if(isNullOrUndefined(attachNum)){attachNum=1}if(isNullOrUndefined(fileType)){fileType="a"}if(isNullOrUndefined(position)){position="m"}modalHref(ctx+"/attach/large/file/upload?attachField="+attachField+"&attachDivId="+attachDivId+"&attachNum="+attachNum+"&fileType="+fileType+"&position="+position,"largeFileUploadModal")};